{"ast":null,"code":"import _isRegExp from \"lodash/isRegExp\";\nimport _isString from \"lodash/isString\";\nimport _includes from \"lodash/includes\";\nimport _isEmpty from \"lodash/isEmpty\";\nimport _isFunction from \"lodash/isFunction\";\nimport _throttle from \"lodash/throttle\";\nimport _assign from \"lodash/assign\";\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n  return arr2;\n}\nimport { Collection, Selection, Data, Helpers } from \"victory-core\";\nimport isEqual from \"react-fast-compare\";\nimport Delaunay from \"delaunay-find/lib/index.js\";\nimport React from \"react\";\nvar VoronoiHelpers = {\n  withinBounds: function withinBounds(props, point) {\n    var width = props.width,\n      height = props.height,\n      polar = props.polar,\n      origin = props.origin,\n      scale = props.scale;\n    var padding = Helpers.getPadding(props, \"voronoiPadding\");\n    var x = point.x,\n      y = point.y;\n    if (polar) {\n      var distanceSquared = Math.pow(x - origin.x, 2) + Math.pow(y - origin.y, 2);\n      var radius = Math.max.apply(Math, _toConsumableArray(scale.y.range()));\n      return distanceSquared < Math.pow(radius, 2);\n    }\n    return x >= padding.left && x <= width - padding.right && y >= padding.top && y <= height - padding.bottom;\n  },\n  getDatasets: function getDatasets(props) {\n    var minDomain = {\n      x: Collection.getMinValue(props.domain.x),\n      y: Collection.getMinValue(props.domain.y)\n    };\n    var children = React.Children.toArray(props.children);\n    var addMeta = function addMeta(data, name, child) {\n      var continuous = child && child.type && child.type.continuous;\n      var style = child ? child.props && child.props.style : props.style;\n      return data.map(function (datum, index) {\n        var _Helpers$getPoint = Helpers.getPoint(datum),\n          x = _Helpers$getPoint.x,\n          y = _Helpers$getPoint.y,\n          y0 = _Helpers$getPoint.y0,\n          x0 = _Helpers$getPoint.x0;\n        var voronoiX = (Number(x) + Number(x0)) / 2;\n        var voronoiY = (Number(y) + Number(y0)) / 2;\n        return _assign({\n          _voronoiX: props.voronoiDimension === \"y\" ? minDomain.x : voronoiX,\n          _voronoiY: props.voronoiDimension === \"x\" ? minDomain.y : voronoiY,\n          eventKey: index,\n          childName: name,\n          continuous: continuous,\n          style: style\n        }, datum);\n      });\n    };\n    if (props.data) {\n      return addMeta(props.data);\n    }\n    var getData = function getData(childProps) {\n      var data = Data.getData(childProps);\n      return Array.isArray(data) && data.length > 0 ? data : undefined;\n    };\n    var iteratee = function iteratee(child, childName) {\n      var childProps = child.props || {};\n      var name = childProps.name || childName;\n      var blacklist = props.voronoiBlacklist || [];\n      var blacklistStr = blacklist.filter(_isString);\n      var blacklistRegExp = blacklist.filter(_isRegExp);\n      var isRegExpMatch = blacklistRegExp.some(function (regExp) {\n        return regExp.test(name);\n      });\n      if (!Data.isDataComponent(child) || _includes(blacklistStr, name) || isRegExpMatch) {\n        return null;\n      }\n      var getChildData = child.type && _isFunction(child.type.getData) ? child.type.getData : getData;\n      var childData = getChildData(child.props);\n      return childData ? addMeta(childData, name, child) : null;\n    };\n    return Helpers.reduceChildren(children, iteratee, props);\n  },\n  findPoints: function findPoints(datasets, point) {\n    return datasets.filter(function (d) {\n      return point._voronoiX === d._voronoiX && point._voronoiY === d._voronoiY;\n    });\n  },\n  withinRadius: function withinRadius(point, mousePosition, radius) {\n    if (!point) {\n      return false;\n    }\n    if (!radius) {\n      return true;\n    }\n    var x = mousePosition.x,\n      y = mousePosition.y;\n    var distanceSquared = Math.pow(x - point[0], 2) + Math.pow(y - point[1], 2);\n    return distanceSquared < Math.pow(radius, 2);\n  },\n  getVoronoiPoints: function getVoronoiPoints(props, mousePosition) {\n    var datasets = this.getDatasets(props);\n    var scaledData = datasets.map(function (d) {\n      var _Helpers$scalePoint = Helpers.scalePoint(props, d),\n        x = _Helpers$scalePoint.x,\n        y = _Helpers$scalePoint.y;\n      return [x, y];\n    });\n    var delaunay = Delaunay.from(scaledData);\n    var index = delaunay.find(mousePosition.x, mousePosition.y);\n    var withinRadius = this.withinRadius(scaledData[index], mousePosition, props.radius);\n    var points = withinRadius ? this.findPoints(datasets, datasets[index]) : [];\n    return {\n      points: points,\n      index: index\n    };\n  },\n  getActiveMutations: function getActiveMutations(props, point) {\n    var childName = point.childName,\n      continuous = point.continuous;\n    var activateData = props.activateData,\n      activateLabels = props.activateLabels,\n      labels = props.labels;\n    if (!activateData && !activateLabels) {\n      return [];\n    }\n    var defaultTarget = activateData ? [\"data\"] : [];\n    var targets = labels && !activateLabels ? defaultTarget : defaultTarget.concat(\"labels\");\n    if (_isEmpty(targets)) {\n      return [];\n    }\n    return targets.map(function (target) {\n      var eventKey = continuous === true && target === \"data\" ? \"all\" : point.eventKey;\n      return {\n        childName: childName,\n        eventKey: eventKey,\n        target: target,\n        mutation: function mutation() {\n          return {\n            active: true\n          };\n        }\n      };\n    });\n  },\n  getInactiveMutations: function getInactiveMutations(props, point) {\n    var childName = point.childName,\n      continuous = point.continuous;\n    var activateData = props.activateData,\n      activateLabels = props.activateLabels,\n      labels = props.labels;\n    if (!activateData && !activateLabels) {\n      return [];\n    }\n    var defaultTarget = activateData ? [\"data\"] : [];\n    var targets = labels && !activateLabels ? defaultTarget : defaultTarget.concat(\"labels\");\n    if (_isEmpty(targets)) {\n      return [];\n    }\n    return targets.map(function (target) {\n      var eventKey = continuous && target === \"data\" ? \"all\" : point.eventKey;\n      return {\n        childName: childName,\n        eventKey: eventKey,\n        target: target,\n        mutation: function mutation() {\n          return null;\n        }\n      };\n    });\n  },\n  // eslint-disable-next-line max-params\n  getParentMutation: function getParentMutation(activePoints, mousePosition, parentSVG, vIndex) {\n    return [{\n      target: \"parent\",\n      eventKey: \"parent\",\n      mutation: function mutation() {\n        return {\n          activePoints: activePoints,\n          mousePosition: mousePosition,\n          parentSVG: parentSVG,\n          vIndex: vIndex\n        };\n      }\n    }];\n  },\n  onActivated: function onActivated(props, points) {\n    if (_isFunction(props.onActivated)) {\n      props.onActivated(points, props);\n    }\n  },\n  onDeactivated: function onDeactivated(props, points) {\n    if (_isFunction(props.onDeactivated)) {\n      props.onDeactivated(points, props);\n    }\n  },\n  onMouseLeave: function onMouseLeave(evt, targetProps) {\n    var _this = this,\n      _this$getParentMutati;\n    var activePoints = targetProps.activePoints || [];\n    this.onDeactivated(targetProps, activePoints);\n    var inactiveMutations = activePoints.length ? activePoints.map(function (point) {\n      return _this.getInactiveMutations(targetProps, point);\n    }) : [];\n    return (_this$getParentMutati = this.getParentMutation([])).concat.apply(_this$getParentMutati, _toConsumableArray(inactiveMutations));\n  },\n  onMouseMove: function onMouseMove(evt, targetProps) {\n    var _this2 = this;\n\n    // eslint-disable-line max-statements\n    var activePoints = targetProps.activePoints || [];\n    var parentSVG = targetProps.parentSVG || Selection.getParentSVG(evt);\n    var mousePosition = Selection.getSVGEventCoordinates(evt, parentSVG);\n    if (!this.withinBounds(targetProps, mousePosition)) {\n      var _this$getParentMutati2;\n      this.onDeactivated(targetProps, activePoints);\n      var _inactiveMutations = activePoints.length ? activePoints.map(function (point) {\n        return _this2.getInactiveMutations(targetProps, point);\n      }) : [];\n      return (_this$getParentMutati2 = this.getParentMutation([], mousePosition, parentSVG)).concat.apply(_this$getParentMutati2, _toConsumableArray(_inactiveMutations));\n    }\n    var _this$getVoronoiPoint = this.getVoronoiPoints(targetProps, mousePosition),\n      _this$getVoronoiPoint2 = _this$getVoronoiPoint.points,\n      points = _this$getVoronoiPoint2 === void 0 ? [] : _this$getVoronoiPoint2,\n      index = _this$getVoronoiPoint.index;\n    var parentMutations = this.getParentMutation(points, mousePosition, parentSVG, index);\n    if (activePoints.length && isEqual(points, activePoints)) {\n      return parentMutations;\n    }\n    this.onActivated(targetProps, points);\n    this.onDeactivated(targetProps, activePoints);\n    var activeMutations = points.length ? points.map(function (point) {\n      return _this2.getActiveMutations(targetProps, point);\n    }) : [];\n    var inactiveMutations = activePoints.length ? activePoints.map(function (point) {\n      return _this2.getInactiveMutations(targetProps, point);\n    }) : [];\n    return parentMutations.concat.apply(parentMutations, _toConsumableArray(inactiveMutations).concat(_toConsumableArray(activeMutations)));\n  }\n};\nexport default {\n  onMouseLeave: VoronoiHelpers.onMouseLeave.bind(VoronoiHelpers),\n  onMouseMove: _throttle(VoronoiHelpers.onMouseMove.bind(VoronoiHelpers), 32,\n  // eslint-disable-line no-magic-numbers\n  {\n    leading: true,\n    trailing: false\n  })\n};","map":null,"metadata":{},"sourceType":"module"}